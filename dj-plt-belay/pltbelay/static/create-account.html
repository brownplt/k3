<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.js"></script>
<script type='text/javascript' src='/static/lib/js/caps.js'></script>
<script type='text/javascript' src='/static/lib/js/common.js'></script>
<script>
$(function() {
  var capServer = new CapServer(newUUIDv4());

  $('#submit').click(function(e) {
    var uname = $('#username').val();
    var password1 = $('#password1').val();
    var password2 = $('#password2').val();

    if(uname.length > 20) {
      alert("We require usernames to be less than 20 characters.");
      return;
    }
    if(password1 !== password2) {
      alert("Passwords did not agree.");
      return;
    }
    if(password1.length < 8) {
      alert("Please use at least 8 characters for your password.");
      return;
    }
    
    function failure() {
      alert("Something went wrong with your request." +
            "Please contact the site administrator " + 
            "(link at the bottom of the page).")
    }

    function create() {
      console.log("Creating account");
      var createAccount = capServer.restore(COMMON.urlPrefix + '/create_plt_account/');
      createAccount.post(
        { username : uname, password : password1 }, 
        function(response) {
          window.location = COMMON.urlPrefix + response.redirectTo;
        },
        failure
      );
    }

    var checkUname = capServer.restore(COMMON.urlPrefix + '/check_uname/');
    checkUname.post(
      { username : uname },
      function(response) {
        if (response.available) { create(); }
        else { alert("That username is taken, please try another."); }
      },
      failure
    );

  });
});
</script>
</head>

<body>

<div>
<div>
Username: <input type="text" id="username" value=""></input>
Password: <input type="password" id="password1" value=""></input>
Password again: <input type="password" id="password2" value=""></input>
<button id="submit" value="Submit">Submit</button>
</div>
</div>

</body>
</html>
